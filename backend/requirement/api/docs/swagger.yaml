openapi: 3.0.0
info:
  title: AI Task Dashboard API
  description: Automatically derived CRUD API documentation based on `Data requirements.md`. Includes standard endpoints for collections with specific ID fetching rules (virtual vs Mongo _id) and derived fields dynamically included in GET responses.
  version: 1.0.0
servers:
  - url: /api/v1
    description: Main API Server

tags:
  - name: Users
  - name: Challenges
  - name: Ideas
  - name: Comments
  - name: Activities
  - name: Notifications

paths:
  # ==============================
  # USERS ENDPOINTS
  # ==============================
  /users:
    get:
      tags: [Users]
      summary: Get all users
      parameters:
        - $ref: '#/components/parameters/LimitParam'
        - $ref: '#/components/parameters/OffsetParam'
      responses:
        '200':
          description: A list of users including derived fields
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/UserResponse'
    post:
      tags: [Users]
      summary: Create a user
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserBase'
      responses:
        '201':
          description: User created
  /users/count:
    get:
      tags: [Users]
      summary: Get user count
      responses:
        '200':
          description: Total count
          content:
            application/json:
              schema:
                type: object
                properties:
                  count: { type: integer }
  /users/{id}:
    get:
      tags: [Users]
      summary: Get user by MongoDB _id
      parameters:
        - $ref: '#/components/parameters/MongoIdParam'
      responses:
        '200':
          description: User object with derived fields
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserResponse'
    put:
      tags: [Users]
      summary: Update a user
      parameters:
        - $ref: '#/components/parameters/MongoIdParam'
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserBase'
      responses:
        '200':
          description: User updated
    delete:
      tags: [Users]
      summary: Delete a user
      parameters:
        - $ref: '#/components/parameters/MongoIdParam'
      responses:
        '204':
          description: User deleted

  # ==============================
  # CHALLENGES ENDPOINTS
  # ==============================
  /challenges:
    get:
      tags: [Challenges]
      summary: Get all challenges
      parameters:
        - $ref: '#/components/parameters/LimitParam'
        - $ref: '#/components/parameters/OffsetParam'
      responses:
        '200':
          description: A list of challenges including derived fields
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ChallengeResponse'
    post:
      tags: [Challenges]
      summary: Create a challenge
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ChallengeBase'
      responses:
        '201':
          description: Challenge created
  /challenges/count:
    get:
      tags: [Challenges]
      summary: Get challenge count
      responses:
        '200':
          description: Total count
          content:
            application/json:
              schema:
                type: object
                properties:
                  count: { type: integer }
  /challenges/{virtualId}:
    get:
      tags: [Challenges]
      summary: Get challenge by Virtual ID (e.g., CH-001)
      parameters:
        - name: virtualId
          in: path
          required: true
          schema:
            type: string
          description: The virtual ID of the challenge
      responses:
        '200':
          description: Challenge object with derived fields
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ChallengeResponse'
    put:
      tags: [Challenges]
      summary: Update a challenge
      parameters:
        - name: virtualId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ChallengeBase'
      responses:
        '200':
          description: Challenge updated
    patch:
      tags: [Challenges]
      summary: Update challenge status (Swim Lane)
      parameters:
        - name: virtualId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required: [status]
              properties:
                status:
                  type: string
                  description: New swim lane status
      responses:
        '200':
          description: Challenge status updated successfully
    delete:
      tags: [Challenges]
      summary: Delete a challenge
      parameters:
        - name: virtualId
          in: path
          required: true
          schema:
            type: string
      responses:
        '204':
          description: Challenge deleted

  # ==============================
  # IDEAS ENDPOINTS
  # ==============================
  /ideas:
    get:
      tags: [Ideas]
      summary: Get all ideas
      parameters:
        - $ref: '#/components/parameters/LimitParam'
        - $ref: '#/components/parameters/OffsetParam'
      responses:
        '200':
          description: A list of ideas including derived fields
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/IdeaResponse'
    post:
      tags: [Ideas]
      summary: Create an idea
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/IdeaBase'
      responses:
        '201':
          description: Idea created
  /ideas/count:
    get:
      tags: [Ideas]
      summary: Get ideas count
      responses:
        '200':
          description: Total count
  /ideas/{virtualId}:
    get:
      tags: [Ideas]
      summary: Get idea by Virtual ID (e.g., ID-0001)
      parameters:
        - name: virtualId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Idea object with derived fields
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/IdeaResponse'
    put:
      tags: [Ideas]
      summary: Update an idea
      parameters:
        - name: virtualId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/IdeaBase'
      responses:
        '200':
          description: Idea updated
    delete:
      tags: [Ideas]
      summary: Delete an idea
      parameters:
        - name: virtualId
          in: path
          required: true
          schema:
            type: string
      responses:
        '204':
          description: Idea deleted

  # ==============================
  # COMMENTS ENDPOINTS
  # ==============================
  /comments:
    get:
      tags: [Comments]
      summary: Get all comments
      parameters:
        - $ref: '#/components/parameters/LimitParam'
        - $ref: '#/components/parameters/OffsetParam'
      responses:
        '200':
          description: A list of comments including derived fields
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/CommentResponse'
    post:
      tags: [Comments]
      summary: Create a comment
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CommentBase'
      responses:
        '201':
          description: Comment created
  /comments/count:
    get:
      tags: [Comments]
      summary: Get comments count
      responses:
        '200':
          description: Total count
  /comments/{id}:
    get:
      tags: [Comments]
      summary: Get comment by MongoDB _id
      parameters:
        - $ref: '#/components/parameters/MongoIdParam'
      responses:
        '200':
          description: Comment object with derived fields
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CommentResponse'
    put:
      tags: [Comments]
      summary: Update a comment
      parameters:
        - $ref: '#/components/parameters/MongoIdParam'
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CommentBase'
      responses:
        '200':
          description: Comment updated
    delete:
      tags: [Comments]
      summary: Delete a comment
      parameters:
        - $ref: '#/components/parameters/MongoIdParam'
      responses:
        '204':
          description: Comment deleted

  # ==============================
  # ACTIVITIES ENDPOINTS
  # ==============================
  /activities:
    get:
      tags: [Activities]
      summary: Get all activities
      description: Highly dynamic list, heavily utilizes pagination limits and offsets.
      parameters:
        - $ref: '#/components/parameters/LimitParam'
        - $ref: '#/components/parameters/OffsetParam'
      responses:
        '200':
          description: A list of activities including contextual derived fields
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ActivityResponse'
    post:
      tags: [Activities]
      summary: Create an activity
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ActivityBase'
      responses:
        '201':
          description: Activity created
  /activities/count:
    get:
      tags: [Activities]
      summary: Get activities count
      responses:
        '200':
          description: Total count
  /activities/{id}:
    get:
      tags: [Activities]
      summary: Get activity by MongoDB _id
      parameters:
        - $ref: '#/components/parameters/MongoIdParam'
      responses:
        '200':
          description: Activity object with derived fields
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ActivityResponse'
    put:
      tags: [Activities]
      summary: Update an activity
      parameters:
        - $ref: '#/components/parameters/MongoIdParam'
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ActivityBase'
      responses:
        '200':
          description: Activity updated
    delete:
      tags: [Activities]
      summary: Delete an activity
      parameters:
        - $ref: '#/components/parameters/MongoIdParam'
      responses:
        '204':
          description: Activity deleted

  # ==============================
  # NOTIFICATIONS ENDPOINTS
  # ==============================
  /notifications:
    get:
      tags: [Notifications]
      summary: Get all notifications for user
      description: Notification stream requiring strict pagination with limits and offsets.
      parameters:
        - $ref: '#/components/parameters/LimitParam'
        - $ref: '#/components/parameters/OffsetParam'
      responses:
        '200':
          description: A list of notifications including contextual derived fields
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/NotificationResponse'
    post:
      tags: [Notifications]
      summary: Create a notification
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/NotificationBase'
      responses:
        '201':
          description: Notification created
  /notifications/count:
    get:
      tags: [Notifications]
      summary: Get notifications count
      responses:
        '200':
          description: Total count
  /notifications/{id}:
    get:
      tags: [Notifications]
      summary: Get notification by MongoDB _id
      parameters:
        - $ref: '#/components/parameters/MongoIdParam'
      responses:
        '200':
          description: Notification object with derived fields
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotificationResponse'
    put:
      tags: [Notifications]
      summary: Update a notification (e.g., mark as read/isSeen)
      parameters:
        - $ref: '#/components/parameters/MongoIdParam'
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/NotificationBase'
      responses:
        '200':
          description: Notification updated
    delete:
      tags: [Notifications]
      summary: Delete a notification
      parameters:
        - $ref: '#/components/parameters/MongoIdParam'
      responses:
        '204':
          description: Notification deleted

components:
  parameters:
    MongoIdParam:
      name: id
      in: path
      required: true
      schema:
        type: string
      description: 24-character hexadecimal MongoDB Object ID
    LimitParam:
      name: limit
      in: query
      required: false
      schema:
        type: integer
        default: 20
      description: Amount of records to return for pagination
    OffsetParam:
      name: offset
      in: query
      required: false
      schema:
        type: integer
        default: 0
      description: Amount of records to skip for pagination

  schemas:
    # ------------------
    # MINIMAL SCHEMAS (FOR REUSE)
    # ------------------
    UserMinimal:
      type: object
      required: [_id, name]
      properties:
        _id: { type: string, description: "MongoDB hex ID" }
        name: { type: string }
        email: { type: string }
        companyTechRole: { type: string }
        role: { type: string, enum: ['ADMIN', 'MEMBER', 'USER'] }

    ChallengeMinimal:
      type: object
      required: [_id, title]
      properties:
        _id: { type: string, description: "MongoDB hex ID" }
        virtualId: { type: string, description: "CH-XXX format" }
        title: { type: string }

    IdeaMinimal:
      type: object
      required: [_id, title]
      properties:
        _id: { type: string, description: "MongoDB hex ID" }
        ideaId: { type: string, description: "ID-XXXX format" }
        title: { type: string }

    CommentMinimal:
      type: object
      properties:
        _id: { type: string, description: "MongoDB hex ID" }
        comment: { type: string }
        userId: { type: string }
        createdat: { type: string, format: date-time }

    # ------------------
    # BASE DB SCHEMAS mapping to input DB fields
    # ------------------
    UserBase:
      type: object
      properties:
        name: { type: string }
        opco: { type: string }
        platform: { type: string }
        companyTechRole: { type: string }
        email: { type: string }
        interestAreas: { type: array, items: { type: string } }
        role: { type: string, enum: ['ADMIN', 'MEMBER', 'USER'] }
        status: { type: string, enum: ['PENDING', 'APPROVED', 'BLOCKED', 'INACTIVE'] }
        innovationScore: { type: integer, minimum: 1, maximum: 999 }
        upvotedChallengeList: { type: array, items: { type: string } }
        upvotedAppreciatedIdeaList: { type: array, items: { type: string } }

    ChallengeBase:
      type: object
      properties:
        title: { type: string }
        opco: { type: string }
        platform: { type: string }
        description: { type: string }
        summary: { type: string }
        outcome: { type: string }
        timeline: { type: string }
        portfolioLane: { type: string }
        priority: { type: string }
        tags: { type: array, items: { type: string }, default: ["ai"] }
        constraint: { type: string }
        stackeHolder: { type: string }
        virtualId: { type: string }
        status: { type: string }
        userId: { type: string }
        month: { type: integer }
        year: { type: integer }
        upVotes: { type: array, items: { type: string } }
        subcriptions: { type: array, items: { type: string } }
        viewCount: { type: integer }
        timestampOfStatusChangedToPilot: { type: string, format: date-time, nullable: true }
        timestampOfCompleted: { type: string, format: date-time, nullable: true }

    IdeaBase:
      type: object
      properties:
        ideaId: { type: string }
        title: { type: string }
        description: { type: string }
        proposedSolution: { type: string }
        expectedImpact: { type: string }
        challengeId: { type: string }
        appreciationCount: { type: integer }
        viewCount: { type: integer }
        userId: { type: string }
        subscription: { type: array, items: { type: string } }
        month: { type: integer }
        year: { type: integer }
        status: { type: boolean }
        upVotes: { type: array, items: { type: string } }

    CommentBase:
      type: object
      properties:
        userId: { type: string }
        comment: { type: string }
        type: { type: string, enum: ['CH', 'ID'] }
        typeId: { type: string }
        createdat: { type: string, format: date-time }

    ActivityBase:
      type: object
      properties:
        type:
          type: string
          enum: [
            'challenge_created', 'idea_created', 'challenge_status_update',
            'challenge_edited', 'idea_edited', 'challenge_upvoted',
            'idea_upvoted', 'challenge_commented', 'idea_commented',
            'challenge_subscribed', 'idea_subscribed', 'challenge_deleted',
            'idea_deleted', 'log_in', 'log_out'
          ]
        fk_id: { type: string, nullable: true }
        userId: { type: string }
        month: { type: integer }
        year: { type: integer }
        createdAt: { type: string, format: date-time }

    NotificationBase:
      type: object
      properties:
        type:
          type: string
          enum: [
            'challenge_created', 'challenge_status_update', 'challenge_edited',
            'idea_edited', 'challenge_upvoted', 'idea_upvoted',
            'challenge_commented', 'idea_commented', 'challenge_subscribed',
            'idea_subscribed', 'challenge_deleted', 'idea_deleted'
          ]
        fk_id: { type: string, nullable: true }
        userId: { type: string }
        isSeen: { type: boolean, default: false }
        createdAt: { type: string, format: date-time }

    # ------------------
    # RESPONSE SCHEMAS combining Base + Derived Fields
    # ------------------
    UserResponse:
      allOf:
        - $ref: '#/components/schemas/UserBase'
        - type: object
          properties:
            _id: { type: string }
            createdAt: { type: string, format: date-time }
            updatedAt: { type: string, format: date-time }
            upvoteCount: { type: integer, description: "(DERIVED) Sum of upvotes on challenges and ideas" }
            recentActivity:
              type: array
              description: "(DERIVED) Top 3 from Activity DB"
              items:
                $ref: '#/components/schemas/ActivityResponse'
            recentSubmission:
              type: array
              description: "(DERIVED) Top 5 from Activity DB (challenge_created or idea_created)"
              items:
                $ref: '#/components/schemas/ActivityResponse'
            contributionGraph:
              type: object
              description: "(DERIVED) Activity group by month for 6 months. Map of month (string) to count (long)"
              additionalProperties:
                type: integer
                format: int64
            commentCount: { type: integer, description: "(DERIVED) Total comments" }
            challengeCount: { type: integer, description: "(DERIVED) Total challenges" }
            totalIdeaCount: { type: integer, description: "(DERIVED) Total ideas" }

    ChallengeResponse:
      allOf:
        - $ref: '#/components/schemas/ChallengeBase'
        - type: object
          properties:
            _id: { type: string }
            createdAt: { type: string, format: date-time }
            updatedAt: { type: string, format: date-time }
            countOfIdeas: { type: integer, description: "(DERIVED) Total active ideas linked" }
            ownerDetails: { $ref: '#/components/schemas/UserMinimal' }
            contributorsDetails: { type: array, items: { $ref: '#/components/schemas/UserMinimal' }, description: "(DERIVED) Populated contributors users details" }
            commentCount: { type: integer, description: "(DERIVED) Calculated from Comments table" }
            ideaList: { type: array, items: { $ref: '#/components/schemas/IdeaMinimal' }, description: "(DERIVED) Full list from Idea collection" }
            comments: { type: array, items: { $ref: '#/components/schemas/CommentMinimal' }, description: "(DERIVED) Full list from Comment collection" }
            contributors: { type: array, items: { $ref: '#/components/schemas/UserMinimal' }, description: "(DERIVED) Owner details of all ideas under challenge" }

    IdeaResponse:
      allOf:
        - $ref: '#/components/schemas/IdeaBase'
        - type: object
          properties:
            _id: { type: string }
            createdAt: { type: string, format: date-time }
            updatedAt: { type: string, format: date-time }
            challengeDetails: { $ref: '#/components/schemas/ChallengeMinimal' }
            problemStatement: { type: string, description: "(DERIVED) The description from the parent Challenge" }
            commentCount: { type: integer, description: "(DERIVED) Count calculated from Comments DB" }
            comments: { type: array, items: { $ref: '#/components/schemas/CommentMinimal' }, description: "(DERIVED) Populated list of comments" }
            ownerDetails: { $ref: '#/components/schemas/UserMinimal' }

    CommentResponse:
      allOf:
        - $ref: '#/components/schemas/CommentBase'
        - type: object
          properties:
            _id: { type: string }
            userDetails: { $ref: '#/components/schemas/UserMinimal' }

    ActivityResponse:
      allOf:
        - $ref: '#/components/schemas/ActivityBase'
        - type: object
          properties:
            _id: { type: string }
            userDetails: { $ref: '#/components/schemas/UserMinimal' }
            entityDetails:
              type: object
              oneOf:
                - $ref: '#/components/schemas/ChallengeMinimal'
                - $ref: '#/components/schemas/IdeaMinimal'
              description: "(DERIVED) What was acted upon (Challenge or Idea)"
            activitySummary: { type: string, description: "(DERIVED) Human readable string generated dynamically" }

    NotificationResponse:
      allOf:
        - $ref: '#/components/schemas/NotificationBase'
        - type: object
          properties:
            _id: { type: string }
            description: { type: string, description: "(DERIVED) Dynamically generated based on Type and initiator" }
            linkedEntityDetails:
              type: object
              oneOf:
                - $ref: '#/components/schemas/ChallengeMinimal'
                - $ref: '#/components/schemas/IdeaMinimal'
              description: "(DERIVED) Details of Challenge or Idea linked via fk_id"
            recipientDetails: { $ref: '#/components/schemas/UserMinimal' }
