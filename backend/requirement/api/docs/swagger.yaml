openapi: 3.0.0
info:
  title: AI Task Dashboard API
  description: Automatically derived CRUD API documentation based on `Data requirements.md`. Includes standard endpoints for collections with specific ID fetching rules (virtual vs Mongo _id) and derived fields dynamically included in GET responses.
  version: 1.0.0
servers:
  - url: /api/v1
    description: Main API Server

tags:
  - name: Users
  - name: Challenges
  - name: Ideas
  - name: Comments
  - name: Activities
  - name: Notifications

paths:
  # ==============================
  # USERS ENDPOINTS
  # ==============================
  /users:
    get:
      tags: [Users]
      summary: Get all users
      parameters:
        - $ref: '#/components/parameters/LimitParam'
        - $ref: '#/components/parameters/OffsetParam'
      responses:
        '200':
          description: A list of users including derived fields
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/UserResponse'
    post:
      tags: [Users]
      summary: Create a user
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserBase'
      responses:
        '201':
          description: User created
  /users/count:
    get:
      tags: [Users]
      summary: Get user count
      responses:
        '200':
          description: Total count
          content:
            application/json:
              schema:
                type: object
                properties:
                  count: { type: integer }
  /users/{id}:
    get:
      tags: [Users]
      summary: Get user by MongoDB _id
      parameters:
        - $ref: '#/components/parameters/MongoIdParam'
      responses:
        '200':
          description: User object with derived fields
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserResponse'
    put:
      tags: [Users]
      summary: Update a user
      parameters:
        - $ref: '#/components/parameters/MongoIdParam'
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserBase'
      responses:
        '200':
          description: User updated
    delete:
      tags: [Users]
      summary: Delete a user
      parameters:
        - $ref: '#/components/parameters/MongoIdParam'
      responses:
        '204':
          description: User deleted

  # ==============================
  # CHALLENGES ENDPOINTS
  # ==============================
  /challenges:
    get:
      tags: [Challenges]
      summary: Get all challenges
      parameters:
        - $ref: '#/components/parameters/LimitParam'
        - $ref: '#/components/parameters/OffsetParam'
      responses:
        '200':
          description: A list of challenges including derived fields
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ChallengeResponse'
    post:
      tags: [Challenges]
      summary: Create a challenge
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ChallengeBase'
      responses:
        '201':
          description: Challenge created
  /challenges/count:
    get:
      tags: [Challenges]
      summary: Get challenge count
      responses:
        '200':
          description: Total count
          content:
            application/json:
              schema:
                type: object
                properties:
                  count: { type: integer }
  /challenges/{virtualId}:
    get:
      tags: [Challenges]
      summary: Get challenge by Virtual ID (e.g., CH-001)
      parameters:
        - name: virtualId
          in: path
          required: true
          schema:
            type: string
          description: The virtual ID of the challenge
      responses:
        '200':
          description: Challenge object with derived fields
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ChallengeResponse'
    put:
      tags: [Challenges]
      summary: Update a challenge
      parameters:
        - name: virtualId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ChallengeBase'
      responses:
        '200':
          description: Challenge updated
    delete:
      tags: [Challenges]
      summary: Delete a challenge
      parameters:
        - name: virtualId
          in: path
          required: true
          schema:
            type: string
      responses:
        '204':
          description: Challenge deleted

  # ==============================
  # IDEAS ENDPOINTS
  # ==============================
  /ideas:
    get:
      tags: [Ideas]
      summary: Get all ideas
      parameters:
        - $ref: '#/components/parameters/LimitParam'
        - $ref: '#/components/parameters/OffsetParam'
      responses:
        '200':
          description: A list of ideas including derived fields
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/IdeaResponse'
    post:
      tags: [Ideas]
      summary: Create an idea
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/IdeaBase'
      responses:
        '201':
          description: Idea created
  /ideas/count:
    get:
      tags: [Ideas]
      summary: Get ideas count
      responses:
        '200':
          description: Total count
  /ideas/{virtualId}:
    get:
      tags: [Ideas]
      summary: Get idea by Virtual ID (e.g., ID-0001)
      parameters:
        - name: virtualId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Idea object with derived fields
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/IdeaResponse'
    put:
      tags: [Ideas]
      summary: Update an idea
      parameters:
        - name: virtualId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/IdeaBase'
      responses:
        '200':
          description: Idea updated
    delete:
      tags: [Ideas]
      summary: Delete an idea
      parameters:
        - name: virtualId
          in: path
          required: true
          schema:
            type: string
      responses:
        '204':
          description: Idea deleted

  # ==============================
  # COMMENTS ENDPOINTS
  # ==============================
  /comments:
    get:
      tags: [Comments]
      summary: Get all comments
      parameters:
        - $ref: '#/components/parameters/LimitParam'
        - $ref: '#/components/parameters/OffsetParam'
      responses:
        '200':
          description: A list of comments including derived fields
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/CommentResponse'
    post:
      tags: [Comments]
      summary: Create a comment
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CommentBase'
      responses:
        '201':
          description: Comment created
  /comments/count:
    get:
      tags: [Comments]
      summary: Get comments count
      responses:
        '200':
          description: Total count
  /comments/{id}:
    get:
      tags: [Comments]
      summary: Get comment by MongoDB _id
      parameters:
        - $ref: '#/components/parameters/MongoIdParam'
      responses:
        '200':
          description: Comment object with derived fields
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CommentResponse'
    put:
      tags: [Comments]
      summary: Update a comment
      parameters:
        - $ref: '#/components/parameters/MongoIdParam'
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CommentBase'
      responses:
        '200':
          description: Comment updated
    delete:
      tags: [Comments]
      summary: Delete a comment
      parameters:
        - $ref: '#/components/parameters/MongoIdParam'
      responses:
        '204':
          description: Comment deleted

  # ==============================
  # ACTIVITIES ENDPOINTS
  # ==============================
  /activities:
    get:
      tags: [Activities]
      summary: Get all activities
      description: Highly dynamic list, heavily utilizes pagination limits and offsets.
      parameters:
        - $ref: '#/components/parameters/LimitParam'
        - $ref: '#/components/parameters/OffsetParam'
      responses:
        '200':
          description: A list of activities including contextual derived fields
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ActivityResponse'
    post:
      tags: [Activities]
      summary: Create an activity
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ActivityBase'
      responses:
        '201':
          description: Activity created
  /activities/count:
    get:
      tags: [Activities]
      summary: Get activities count
      responses:
        '200':
          description: Total count
  /activities/{id}:
    get:
      tags: [Activities]
      summary: Get activity by MongoDB _id
      parameters:
        - $ref: '#/components/parameters/MongoIdParam'
      responses:
        '200':
          description: Activity object with derived fields
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ActivityResponse'
    put:
      tags: [Activities]
      summary: Update an activity
      parameters:
        - $ref: '#/components/parameters/MongoIdParam'
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ActivityBase'
      responses:
        '200':
          description: Activity updated
    delete:
      tags: [Activities]
      summary: Delete an activity
      parameters:
        - $ref: '#/components/parameters/MongoIdParam'
      responses:
        '204':
          description: Activity deleted

  # ==============================
  # NOTIFICATIONS ENDPOINTS
  # ==============================
  /notifications:
    get:
      tags: [Notifications]
      summary: Get all notifications for user
      description: Notification stream requiring strict pagination with limits and offsets.
      parameters:
        - $ref: '#/components/parameters/LimitParam'
        - $ref: '#/components/parameters/OffsetParam'
      responses:
        '200':
          description: A list of notifications including contextual derived fields
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/NotificationResponse'
    post:
      tags: [Notifications]
      summary: Create a notification
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/NotificationBase'
      responses:
        '201':
          description: Notification created
  /notifications/count:
    get:
      tags: [Notifications]
      summary: Get notifications count
      responses:
        '200':
          description: Total count
  /notifications/{id}:
    get:
      tags: [Notifications]
      summary: Get notification by MongoDB _id
      parameters:
        - $ref: '#/components/parameters/MongoIdParam'
      responses:
        '200':
          description: Notification object with derived fields
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotificationResponse'
    put:
      tags: [Notifications]
      summary: Update a notification (e.g., mark as read/isSeen)
      parameters:
        - $ref: '#/components/parameters/MongoIdParam'
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/NotificationBase'
      responses:
        '200':
          description: Notification updated
    delete:
      tags: [Notifications]
      summary: Delete a notification
      parameters:
        - $ref: '#/components/parameters/MongoIdParam'
      responses:
        '204':
          description: Notification deleted

components:
  parameters:
    MongoIdParam:
      name: id
      in: path
      required: true
      schema:
        type: string
      description: 24-character hexadecimal MongoDB Object ID
    LimitParam:
      name: limit
      in: query
      required: false
      schema:
        type: integer
        default: 20
      description: Amount of records to return for pagination
    OffsetParam:
      name: offset
      in: query
      required: false
      schema:
        type: integer
        default: 0
      description: Amount of records to skip for pagination

  schemas:
    # ------------------
    # BASE DB SCHEMAS mapping to input DB fields
    # ------------------
    UserBase:
      type: object
      properties:
        name: { type: string }
        opco: { type: string }
        platform: { type: string }
        companyTechRole: { type: string }
        email: { type: string }
        interestAreas: { type: array, items: { type: string } }
        role: { type: string }
        status: { type: string }
        innovationScore: { type: integer }

    ChallengeBase:
      type: object
      properties:
        title: { type: string }
        opco: { type: string }
        platform: { type: string }
        description: { type: string }
        summary: { type: string }
        outcome: { type: string }
        timeline: { type: string }
        portfolioLane: { type: string }
        priority: { type: string }
        tags: { type: array, items: { type: string } }
        constraint: { type: string }
        stackeHolder: { type: string }
        status: { type: string }

    IdeaBase:
      type: object
      properties:
        title: { type: string }
        description: { type: string }
        proposedSolution: { type: string }
        expectedImpact: { type: string }
        challengeId: { type: string }

    CommentBase:
      type: object
      properties:
        userId: { type: string }
        comment: { type: string }
        type: { type: string, enum: ['CH', 'ID'] }
        typeId: { type: string }

    ActivityBase:
      type: object
      properties:
        type: { type: string }
        fk_id: { type: string, nullable: true }
        userId: { type: string }

    NotificationBase:
      type: object
      properties:
        type: { type: string }
        fk_id: { type: string, nullable: true }
        userId: { type: string }
        isSeen: { type: boolean }

    # ------------------
    # RESPONSE SCHEMAS combining Base + Derived Fields
    # ------------------
    UserResponse:
      allOf:
        - $ref: '#/components/schemas/UserBase'
        - type: object
          properties:
            _id: { type: string }
            upvoteCount: { type: integer, description: "(DERIVED) Sum of upvotes on challenges and ideas" }
            recentActivity:
              type: array
              description: "(DERIVED) Top 3 from Notification Event DB"
              items:
                type: object
                properties:
                  type: { type: string }
                  timestamp: { type: string, format: date-time }
                  description: { type: string }
            recentSubmission:
              type: array
              description: "(DERIVED) Top 5 from Activity DB (challenge_created or idea_created)"
              items:
                type: object
                properties:
                  type: { type: string }
                  timestamp: { type: string, format: date-time }
                  itemTitle: { type: string }
            contributionGraph:
              type: array
              description: "(DERIVED) Activity group by month for 6 months"
              items:
                type: object
                properties:
                  month: { type: string }
                  year: { type: integer }
                  activityCount: { type: integer }
            commentCount: { type: integer, description: "(DERIVED) Total comments" }
            challengeCount: { type: integer, description: "(DERIVED) Total challenges" }
            totalIdeaCount: { type: integer, description: "(DERIVED) Total ideas" }

    ChallengeResponse:
      allOf:
        - $ref: '#/components/schemas/ChallengeBase'
        - type: object
          properties:
            _id: { type: string }
            virtualId: { type: string }
            countOfIdeas: { type: integer, description: "(DERIVED) Total active ideas linked" }
            ownerDetails: { type: object, description: "(DERIVED) Fetched from Users" }
            contributorsDetails: { type: array, items: { type: object }, description: "(DERIVED) Populated contributors users details" }
            commentCount: { type: integer, description: "(DERIVED) Calculated from Comments table" }
            ideaList: { type: array, items: { type: object }, description: "(DERIVED) Full list from Idea collection" }
            comments: { type: array, items: { type: object }, description: "(DERIVED) Full list from Comment collection" }

    IdeaResponse:
      allOf:
        - $ref: '#/components/schemas/IdeaBase'
        - type: object
          properties:
            _id: { type: string }
            ideaId: { type: string }
            challengeDetails: { type: object, description: "(DERIVED) Object fetched from Challenge DB" }
            problemStatement: { type: string, description: "(DERIVED) The description from the parent Challenge" }
            commentCount: { type: integer, description: "(DERIVED) Count calculated from Comments DB" }
            comments: { type: array, items: { type: object }, description: "(DERIVED) Populated list of comments" }
            ownerDetails: { type: object, description: "(DERIVED) Fetched from User DB via User Id" }

    CommentResponse:
      allOf:
        - $ref: '#/components/schemas/CommentBase'
        - type: object
          properties:
            _id: { type: string }
            userDetails: { type: object, description: "(DERIVED) From user DB by userId" }

    ActivityResponse:
      allOf:
        - $ref: '#/components/schemas/ActivityBase'
        - type: object
          properties:
            _id: { type: string }
            userDetails: { type: object, description: "(DERIVED) Who performed the action" }
            entityDetails: { type: object, description: "(DERIVED) What was acted upon" }
            activitySummary: { type: string, description: "(DERIVED) Human readable string generated dynamically" }

    NotificationResponse:
      allOf:
        - $ref: '#/components/schemas/NotificationBase'
        - type: object
          properties:
            _id: { type: string }
            description: { type: string, description: "(DERIVED) Dynamically generated based on Type and initiator" }
            linkedEntityDetails: { type: object, description: "(DERIVED) Details of Challenge/Idea linked via fk_id" }
            recipientDetails: { type: object, description: "(DERIVED) User details fetched via userId" }
