# Step 3.5 — Cross-Referencing Verification Report

> **Purpose:** Produce a field-level ADD/REMOVE/MODIFY manifest for the BACKEND_CODER_AGENT (Step 4).
> **Verification layers:** `Data requirements.txt` ↔ DB model specs ↔ Schema markdown ↔ `swagger.yaml` ↔ v2 API specs ↔ **existing TypeScript code**

---

## Layer Consistency Check

All three spec layers are **consistent** — no contradictions found between:
- `Data requirements.txt` ↔ DB model specs ↔ Schema markdown files ✅
- Schema markdown ↔ `swagger.yaml` Base schemas ✅
- `swagger.yaml` ↔ v2 API impl specs ✅

---

## Per-Domain Implementation Checklist

### 1. Challenge (`src/models/challenges/challenge.schema.ts`)

| Action | Field / Endpoint | Details |
|--------|-----------------|---------|
| **MODIFY** | `owner` → `userId` | Change from `ObjectId` ref to `String` type |
| **MODIFY** | `opco` | Change from `[String]` array to `String` |
| **MODIFY** | `platform` | Change from `[String]` array to `String` |
| **ADD** | `virtualId` | `String`, required, unique, format `CH-001` |
| **ADD** | `summary` | `String` |
| **ADD** | `outcome` | `String` |
| **ADD** | `stakeHolder` | `String` |
| **ADD** | `upVotes` | `[String]`, default `[]` |
| **ADD** | `subcriptions` | `[String]`, default `[]` (preserve typo) |
| **ADD** | `viewCount` | `Number`, default 0 |
| **ADD** | `timestampOfStatusChangedToPilot` | `Date`, nullable |
| **ADD** | `timestampOfCompleted` | `Date`, nullable |
| **REMOVE** | `ideasCount` | Not in spec |
| **REMOVE** | `contributor` | Not in spec (derived field only) |
| **ADD** | `PATCH /{virtualId}/status` | New endpoint in controller |
| **ADD** | `POST /{virtualId}/upvote` | New endpoint in controller |
| **ADD** | `POST /{virtualId}/subscribe` | New endpoint in controller |

### 2. Idea (`src/models/ideas/idea.schema.ts`)

| Action | Field / Endpoint | Details |
|--------|-----------------|---------|
| **MODIFY** | `owner` → `userId` | Change from `ObjectId` ref to `String` |
| **MODIFY** | `linkedChallenge` → `challengeId` | Change from `ObjectId` to `String` |
| **MODIFY** | `status` | Change from `String` (enum) to `Boolean` (default true) |
| **MODIFY** | `stats.appreciations` → `appreciationCount` | Flatten from nested object to top-level Number |
| **MODIFY** | `stats.views` → `viewCount` | Flatten |
| **ADD** | `ideaId` | `String`, required, unique, format `ID-0001` |
| **ADD** | `upVotes` | `[String]`, default `[]` |
| **ADD** | `subscription` | `[String]`, default `[]` |
| **ADD** | `month` | `Number` |
| **ADD** | `year` | `Number` |
| **REMOVE** | `approach` | Not in spec |
| **REMOVE** | `problemStatement` | DB field → derived field only |
| **REMOVE** | `proposedSolution` kept | (actually in spec, keep it) |
| **REMOVE** | `expectedImpact` | Not in spec |
| **REMOVE** | `implementationPlan` | Not in spec |
| **REMOVE** | `expectedSavings` | Not in spec |
| **REMOVE** | `impactLevel` | Not in spec |
| **REMOVE** | `priority` | Not in spec |
| **REMOVE** | `activity` (array) | Not in spec |
| **REMOVE** | `stats` (nested obj) | Flattened into top-level fields |
| **ADD** | `POST /{virtualId}/upvote` | New endpoint |
| **ADD** | `POST /{virtualId}/subscribe` | New endpoint |

### 3. User (`src/models/users/user.schema.ts`)

| Action | Field / Endpoint | Details |
|--------|-----------------|---------|
| **MODIFY** | `interests` → `interestAreas` | Rename field |
| **ADD** | `companyTechRole` | `String` |
| **ADD** | `status` | `String`, enum `PENDING/APPROVED/BLOCKED/INACTIVE` |
| **ADD** | `innovationScore` | `Number`, default 0 |
| **ADD** | `upvotedChallengeList` | `[String]`, default `[]` |
| **ADD** | `upvotedAppreciatedIdeaList` | `[String]`, default `[]` |
| **REMOVE** | `avatar` | Not in spec |
| **REMOVE** | `initial` | Not in spec |
| **REMOVE** | `avatarColor` | Not in spec |

### 4. Comment (`src/models/comments/comment.schema.ts`)

| Action | Field / Endpoint | Details |
|--------|-----------------|---------|
| **MODIFY** | `parentId` → `typeId` | Change from `ObjectId` to `String` |
| **MODIFY** | `type` enum | Change from `TargetType.Challenge/Idea` to `'CH'/'ID'` strings |
| **ADD** | `createdat` | `Date`, default `Date.now` (lowercase 'a') |
| **MODIFY** | timestamps | Change from `timestamps: true` to `timestamps: false` (uses explicit `createdat`) |

### 5. Notification (`src/models/notifications/notification.schema.ts`)

| Action | Field / Endpoint | Details |
|--------|-----------------|---------|
| **REMOVE** | `title` | Not in spec |
| **REMOVE** | `text` | Not in spec |
| **REMOVE** | `link` | Not in spec |
| **REMOVE** | `unread` | Replaced by `isSeen` |
| **REMOVE** | `relatedEntityId` | Replaced by `fk_id` |
| **ADD** | `type` | `String`, 13-value enum |
| **ADD** | `fk_id` | `String`, nullable |
| **ADD** | `initiatorId` | `String`, required |
| **ADD** | `isSeen` | `Boolean`, default false |
| **MODIFY** | `type` enum | Replace `CHALLENGE/IDEA/COMMENT/STATUS/SYSTEM` with event-based enum |
| **ADD** | `PATCH /{id}/status` | New endpoint (update isSeen) |

### 6. Activity (`src/models/user-actions/user-action.schema.ts` → `activity.schema.ts`)

| Action | Field / Endpoint | Details |
|--------|-----------------|---------|
| **MODIFY** | Collection rename | `user-actions` → `activities` |
| **MODIFY** | Schema rename | `UserAction` → `Activity` |
| **REMOVE** | `targetId` | Not in spec |
| **REMOVE** | `targetType` | Not in spec |
| **REMOVE** | `actionType` | Not in spec |
| **ADD** | `type` | `String`, 15-value enum |
| **ADD** | `fk_id` | `String`, nullable |
| **ADD** | `month` | `Number` |
| **ADD** | `year` | `Number` |
| **ADD** | Pre-save hook | Extract month/year from createdAt |

---

## Contradictions Found: **None** ✅

All three spec layers (Data requirements → Schemas → Swagger → API specs) are aligned. The BACKEND_CODER_AGENT can proceed with the checklist above.
